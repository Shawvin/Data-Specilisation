---
title: Analysis of storm data to evaluate the impacts of different severe weather
  events
author: "Shawvin"
date: "6/16/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Synopsis
Storm and other severe weather events can cause problem both to public health and economy. To more severe extent, they can cause disaster and casuality. Preventing the severe outcome and minimizing the damage of severe weather can protect the community and economy.The project explore the storm data from U.S. National Oceanic and Atmospheric Administration's (NOAA) database. This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.The analysis will indentify the events that are most harmful to public health and economy.

## Data Processing
```{r load_and_preprocessing, cache=TRUE}
library(dplyr)
if (!file.exists("repdata_data_StormData.csv.bz2")) setwd("C5Week4")
data<-read.csv("repdata_data_StormData.csv.bz2",stringsAsFactors = FALSE)

table(data$PROPDMGEXP)
data$PROPDMGEXP[data$PROPDMGEXP==""]<-1
data$PROPDMGEXP<-gsub("[0-9]",1,data$PROPDMGEXP)
data$PROPDMGEXP<-gsub("[-?+]",1,data$PROPDMGEXP)
data$PROPDMGEXP<-gsub("[hH]",1,data$PROPDMGEXP)
data$PROPDMGEXP<-gsub("[kK]",10^3,data$PROPDMGEXP)
data$PROPDMGEXP<-gsub("[mM]",10^6,data$PROPDMGEXP)
data$PROPDMGEXP<-gsub("[Bb]",10^9,data$PROPDMGEXP)
data$PROPDMGEXP<-as.numeric(data$PROPDMGEXP)
table(data$PROPDMGEXP)

table(data$CROPDMGEXP)
data$CROPDMGEXP[data$CROPDMGEXP==""]<-1
data$CROPDMGEXP<-gsub("[0-9]",1,data$CROPDMGEXP)
data$CROPDMGEXP<-gsub("[?]",1,data$CROPDMGEXP)
data$CROPDMGEXP<-gsub("[kK]",10^3,data$CROPDMGEXP)
data$CROPDMGEXP<-gsub("[mM]",10^6,data$CROPDMGEXP)
data$CROPDMGEXP<-gsub("[Bb]",10^9,data$CROPDMGEXP)
data$CROPDMGEXP<-as.numeric(data$CROPDMGEXP)
table(data$CROPDMGEXP)

##only select the column realted to public health and economy
select_data<-select(data,EVTYPE,FATALITIES,INJURIES,PROPDMG,PROPDMGEXP,CROPDMG,CROPDMGEXP)


##sum the damage caused by each event
plotdata<-select_data %>% group_by(EVTYPE) %>% summarise(FATALITIES=sum(FATALITIES),INJURIES=sum(INJURIES),PROPDMG=sum(PROPDMG*PROPDMGEXP),CROPDMG=sum(CROPDMG*CROPDMGEXP))

##choose the top 5 events that cause damage to public health and economy
Most_Fatal<-plotdata[order(plotdata$FATALITIES,decreasing=TRUE),][1:5,c(1,2)]
Most_Injured<-plotdata[order(plotdata$INJURIES,decreasing=TRUE),][1:5,c(1,3)]
Most_PROPDMG<-plotdata[order(plotdata$PROPDMG,decreasing=TRUE),][1:5,c(1,4)]
Most_CROPDMG<-plotdata[order(plotdata$CROPDMG,decreasing=TRUE),][1:5,c(1,5)]
```
## Result
### TOP 5 events that caused fatalites and Injuries
```{r echo=FALSE}
library(ggplot2)
par(mfrow=c(2,1))
ggplot(Most_Fatal,aes(EVTYPE,FATALITIES,fill=EVTYPE))+geom_bar(stat="identity")+coord_flip()
ggplot(Most_Injured,aes(EVTYPE,INJURIES,fill=EVTYPE))+geom_bar(stat="identity")+coord_flip()
```

### TOP 5 events that caused property damage and crop damage
```{r echo=FALSE}
library(ggplot2)
par(mfrow=c(2,1))
ggplot(Most_PROPDMG,aes(EVTYPE,PROPDMG,fill=EVTYPE))+geom_bar(stat="identity")+coord_flip()
ggplot(Most_CROPDMG,aes(EVTYPE,CROPDMG,fill=EVTYPE))+geom_bar(stat="identity")+coord_flip()
```

## Conclusion
* The top five events that caused most fatalites are: `r Most_Fatal$EVTYPE`
* The top five events that caused most injuries are: `r Most_Injured$EVTYPE`
* The top five events that caused most property damage are: `r Most_PROPDMG$EVTYPE`
* The top five events that caused most crop damage are: `r Most_CROPDMG$EVTYPE`
